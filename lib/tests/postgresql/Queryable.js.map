{"version":3,"sources":["../../../src/tests/postgresql/Queryable.js"],"names":["pool","Pool","host","user","password","database","port","createDatabaseAsync","TableCreator","createTableIfNotExistsAsync","schema","testSchema","dropTableAsync","dropTableIfExistsAsync","fillDatabaseAsync","table","tests","x","testsPromise","addAsync","firstName","push","Promise","all","exports","Table","results","where","column","endsWith","or","startsWith","and","contains","orderByDesc","toArrayAsync","assert","equal","length","removeAsync","error","isInExpression","select","take","isIn","result","getFirstAsync","updateAsync","count","getCountAsync","queryable","Queryable","query","type","json","isEqualTo","toJson","roleQueryable","id","queryable2","fromJson","json2"],"mappings":"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","sourcesContent":["import * as assert from \"assert\";\nimport { Pool } from \"pg\";\nimport Table from \"../../postgresql/Table\";\nimport testSchema from \"./testSchemas/person\";\nimport TableCreator from \"../../postgresql/TableCreator\";\nimport Queryable from \"../../../lib/queryable/Queryable\";\n\nconst pool = new Pool({\n    host: \"localhost\",\n    user: \"test_user\",\n    password: \"test_user_pass\",\n    database: \"tests\",\n    port: 5432\n  });\n\nconst createDatabaseAsync = () => {\n    return TableCreator.createTableIfNotExistsAsync({\n        database: pool,\n        schema: testSchema\n    });\n}\n\nconst dropTableAsync = () => {\n    return TableCreator.dropTableIfExistsAsync({\n        database: pool,\n        schema: testSchema\n    });\n};\n\nconst fillDatabaseAsync = (table) => {\n    const tests = [];\n\n    for (let x = 0; x < 300; x++) {\n        const testsPromise = table.addAsync({\n            firstName: `John_${x}_`\n        });\n        tests.push(testsPromise);\n    }\n\n    return Promise.all(tests);\n\n}\n\nexports[\"Queryable: toArrayAsync.\"] = async () => {\n\n    try {\n        await createDatabaseAsync();\n\n        const table = new Table({\n            database: pool,\n            schema: testSchema\n        });\n\n        await fillDatabaseAsync(table);\n\n        let results = await table.where()\n            .column(\"firstName\")\n            .endsWith(\"ohn_1_\")\n            .or()\n            .column(\"firstName\")\n            .startsWith(\"John_2_\")\n            .and()\n            .column(\"firstName\")\n            .contains(\"John\")\n            .orderByDesc(\"id\")\n            .toArrayAsync();\n\n        assert.equal(results.length, 2);\n\n        await table.where()\n            .column(\"firstName\")\n            .contains(\"John\")\n            .removeAsync();\n\n        results = await table.where().toArrayAsync();\n        assert.equal(results.length, 0);\n    } catch (error) {\n        throw error;\n    } finally {\n        await dropTableAsync();\n    }\n\n};\n\nexports[\"Queryable: IsIn with Queryable.\"] = async () => {\n    try {\n        await createDatabaseAsync();\n\n        const table = new Table({\n            database: pool,\n            schema: testSchema\n        });\n\n        await fillDatabaseAsync(table);\n\n        const isInExpression = table.where().select({ \"firstName\": \"firstName\" }).take(1);\n        \n        const results = await table.where()\n            .column(\"firstName\")\n            .isIn(isInExpression)\n            .toArrayAsync();\n\n        assert.equal(results.length, 1);\n\n    } catch (error) {\n        throw error;\n    } finally {\n        await dropTableAsync();\n    }\n\n};\n\nexports[\"Queryable: IsIn with Array.\"] = async () => {\n    try {\n        await createDatabaseAsync();\n\n        const table = new Table({\n            database: pool,\n            schema: testSchema\n        });\n\n        await fillDatabaseAsync(table);\n\n        const results = await table.where()\n            .column(\"firstName\")\n            .isIn([`John_1_`])\n            .toArrayAsync();\n\n        assert.equal(results.length, 1);\n\n    } catch (error) {\n        throw error;\n    } finally {\n        await dropTableAsync();\n    }\n\n};\n\nexports[\"Queryable: getFirstAsync\"] = async () => {\n    try {\n        await createDatabaseAsync();\n\n        const table = new Table({\n            database: pool,\n            schema: testSchema\n        });\n\n        await fillDatabaseAsync(table);\n\n        const result = await table.where()\n            .column(\"firstName\")\n            .endsWith(\"_1_\")\n            .getFirstAsync();\n\n        assert.equal(result != null, true);\n\n    } catch (error) {\n        throw error;\n    } finally {\n        await dropTableAsync();\n    }\n\n};\n\nexports[\"Queryable: removeAsync\"] = async () => {\n    try {\n        await createDatabaseAsync();\n\n        const table = new Table({\n            database: pool,\n            schema: testSchema\n        });\n\n        await fillDatabaseAsync(table);\n\n        await table.where()\n            .column(\"firstName\")\n            .contains(\"John\")\n            .removeAsync();\n        const results = await table.where().toArrayAsync();\n\n        assert.equal(results.length, 0);\n\n    } catch (error) {\n        throw error;\n    } finally {\n        await dropTableAsync();\n    }\n};\n\nexports[\"Queryable: updateAsync\"] = async () => {\n    try {\n        await createDatabaseAsync();\n\n        const table = new Table({\n            database: pool,\n            schema: testSchema\n        });\n\n        await fillDatabaseAsync(table);\n        await table.where()\n            .column(\"firstName\")\n            .endsWith(\"hn_1_\")\n            .updateAsync({\n                firstName: \"Jane\"\n            });\n\n        const results = await table.where()\n            .column(\"firstName\")\n            .endsWith(\"Jane\")\n            .toArrayAsync();\n\n        assert.equal(results[0].firstName, \"Jane\");\n\n    } catch (error) {\n        throw error;\n    } finally {\n        await dropTableAsync();\n    }\n};\n\nexports[\"Queryable: getCountAsync\"] = async () => {\n    try {\n        await createDatabaseAsync();\n\n        const table = new Table({\n            database: pool,\n            schema: testSchema\n        });\n\n        await fillDatabaseAsync(table);\n\n        const count = await table.where()\n            .column(\"firstName\")\n            .contains(\"John\")\n            .getCountAsync();\n\n        assert.equal(count, 300);\n\n    } catch (error) {\n        throw error;\n    } finally {\n        await dropTableAsync();\n    }\n};\n\nexports[\"Queryable: toJson\"] = function () {\n    const queryable = new Queryable({ query: { type: \"person\" } });\n    const json = queryable.column(\"firstName\").isEqualTo(\"Joe\").toJson();\n\n    assert.equal(json, `{\"type\":\"person\",\"expression\":{\"type\":\"isEqualTo\",\"isComposite\":true,\"children\":[{\"type\":\"property\",\"isComposite\":true,\"children\":[{\"type\":\"type\",\"isComposite\":false,\"value\":\"person\"},{\"type\":\"propertyName\",\"isComposite\":false,\"value\":\"firstName\"}]},{\"type\":\"string\",\"isComposite\":false,\"value\":\"Joe\"}]},\"select\":{},\"limit\":-1,\"offset\":0,\"orderBy\":[]}`);\n};\n\nexports[\"Queryable: fromJson\"] = function () {\n    const queryable = new Queryable({ query: { type: \"person\" } });\n    const roleQueryable = new Queryable({ query: { type: \"role\" } }).column(\"name\").isEqualTo(\"admin\").select({ id: \"id\" });\n\n    const json = queryable.column(\"firstName\").isEqualTo(\"Joe\").and().column(\"roleId\").isIn(roleQueryable).toJson();\n\n    const queryable2 = Queryable.fromJson(json);\n    const json2 = queryable2.toJson();\n\n    assert.equal(json, json2);\n};\n"],"file":"Queryable.js"}